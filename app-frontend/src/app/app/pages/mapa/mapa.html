<!-- Header -->
<div class="header">
  <div class="logo-section" (click)="irDashboard()" style="cursor: pointer;">
    <span class="logo-icon">â™»ï¸</span>
    <span class="logo-text">EcoRecolecta</span>
  </div>
  <div class="page-title">ğŸ“ Mapa de Rutas</div>
</div>

<!-- Contenedor principal -->
<div class="map-container">

  <!-- Sidebar izquierda: rutas activas -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Rutas Activas</h2>
      <p>Gestiona y visualiza todas tus rutas</p>
    </div>

    <!-- LISTA DINÃMICA -->
    <div class="routes-list">
      <div *ngIf="rutas.length === 0" class="route-card empty">
        <div class="route-header">
          <span class="route-name">AÃºn no hay rutas creadas</span>
        </div>
        <div class="route-info">
          <span class="route-info-item">
            Usa el botÃ³n "Crear Ruta" para registrar la primera.
          </span>
        </div>
      </div>

      <div
        class="route-card"
        *ngFor="let ruta of rutas"
        [class.active]="rutaSeleccionada?.id === ruta.id"
        (click)="mostrarRuta(ruta)"
      >
        <div class="route-header">
          <span class="route-name">ğŸš› {{ ruta.nombre_ruta }}</span>
        </div>

        <div class="route-info">
          <span class="route-info-item">
            ğŸ“ {{ (ruta.shape?.coordinates?.length) || 0 }} puntos
          </span>
        </div>
      </div>
    </div>
  </div> <!-- FIN SIDEBAR -->

  <!-- Centro: mapa -->
  <div id="mapContainer"></div>

  <!-- Panel derecho: resumen + controles -->
  <div class="right-panel">
    <div class="stats-panel">
      <div class="stat-card">
        <div class="stat-value">{{ rutas.length }}</div>
        <div class="stat-label">Rutas Totales</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">
          {{ rutaSeleccionada ? (rutaSeleccionada.shape?.coordinates?.length || 0) : 0 }}
        </div>
        <div class="stat-label">Puntos en Ruta</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" [style.color]="animacionActiva ? (animacionPausada ? '#f59e0b' : '#16a34a') : '#6b7280'">
          {{ animacionActiva ? (animacionPausada ? 'â¸ï¸' : 'ğŸš—') : 'â¸ï¸' }}
        </div>
        <div class="stat-label">
          {{ animacionActiva ? (animacionPausada ? 'Pausado' : 'En Recorrido') : 'Detenido' }}
        </div>
      </div>
    </div>

    <div class="controls-panel">
      <!-- ğŸš— BotÃ³n: Iniciar Ruta -->
      <button 
        class="control-btn vehicle-btn" 
        (click)="iniciarAnimacionRuta()"
        [disabled]="!rutaSeleccionada || animacionActiva"
        title="Iniciar recorrido animado"
      >
        ğŸš— Iniciar Ruta
      </button>

      <!-- â–¶ï¸ NUEVO: BotÃ³n Continuar (solo visible cuando estÃ¡ pausado) -->
      <button 
        *ngIf="animacionActiva && animacionPausada"
        class="control-btn continue-btn" 
        (click)="pausarReanudarAnimacion()"
        title="Continuar recorrido"
      >
        â–¶ï¸ Continuar Ruta
      </button>

      <!-- â¸ï¸ NUEVO: BotÃ³n Pausar (solo visible cuando estÃ¡ en movimiento) -->
      <button 
        *ngIf="animacionActiva && !animacionPausada"
        class="control-btn pause-btn" 
        (click)="pausarReanudarAnimacion()"
        title="Pausar recorrido"
      >
        â¸ï¸ Pausar
      </button>

      <!-- ğŸ›‘ BotÃ³n: Detener -->
      <button 
        class="control-btn stop-btn" 
        (click)="detenerAnimacion()"
        [disabled]="!animacionActiva"
        title="Detener recorrido completamente"
      >
        ğŸ›‘ Detener
      </button>

      <button class="control-btn primary btn-create-route" (click)="onCrearRuta()">
        â• Crear Ruta
      </button>

      <button class="control-btn" (click)="guardarRuta()">
        ğŸ’¾ Guardar Ruta
      </button>

      <button class="control-btn trash-btn" (click)="limpiarMapa()" title="Limpiar mapa">
        ğŸ—‘ï¸
      </button>

      <button class="control-btn" (click)="zoomIn()" title="Acercar">
        â•
      </button>

      <button class="control-btn" (click)="zoomOut()" title="Alejar">
        â–
      </button>
    </div>
  </div> <!-- FIN RIGHT PANEL -->

</div> <!-- FIN CONTENEDOR PRINCIPAL -->

<!-- MODAL PARA CREAR RUTA -->
<div class="modal-overlay" *ngIf="mostrarModalNombreRuta" (click)="cerrarModalOverlay($event)">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ğŸ—ºï¸ Crear Nueva Ruta</h2>
      <button class="modal-close-btn" (click)="cancelarNombreRuta()">âœ•</button>
    </div>

    <div class="modal-body">
      <label for="nombreRutaInput" class="modal-label">Nombre de la ruta:</label>
      <input
        type="text"
        id="nombreRutaInput"
        class="modal-input"
        [(ngModel)]="nombreRuta"
        placeholder="Ej: Ruta Zona Norte"
        (keyup.enter)="confirmarNombreRuta()"
        autofocus
      />
      <p class="modal-hint">ğŸ’¡ DespuÃ©s podrÃ¡s hacer clic en el mapa para marcar los puntos de la ruta.</p>
    </div>

    <div class="modal-footer">
      <button class="modal-btn modal-btn-secondary" (click)="cancelarNombreRuta()">
        Cancelar
      </button>
      <button class="modal-btn modal-btn-primary" (click)="confirmarNombreRuta()">
        âœ“ Confirmar
      </button>
    </div>
  </div>
</div>

<!-- TOAST NOTIFICATION -->
<div class="toast-container" *ngIf="toastVisible">
  <div class="toast" [class.warning]="toastType === 'warning'">
    <div class="toast-icon">{{ toastType === 'warning' ? 'âš ï¸' : 'ğŸ“' }}</div>
    <div class="toast-message">{{ toastMessage }}</div>
    <button class="toast-close" (click)="cerrarToast()">âœ•</button>
  </div>
</div>